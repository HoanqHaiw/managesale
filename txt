TẠO CATEGORY
THAY CATEGORY THÀNH CÁC FILE PHÙ HỢP --
TRANG PRODUCT HIỆN TÊN NGƯỜI DÙNG ĐÃ ĐĂNG NHẬP THÀNH CÔNG
PHẦN PUSH SONG RỒI NHƯNG CHƯA CONNECT VS ADMIN
PHẦN PRODUCT ADMIN KHÔNG CÓ
NÚT SỬA SẢN PHẨM CHƯA KẾT NỐI ĐƯỢC VỚI EDIT_PRODUCT



//  Hiển thị giỏ hàng
function loadCart() {
    let cart = JSON.parse(localStorage.getItem("cart")) || []; // Lấy giỏ hàng từ localStorage (nếu không có thì gán mảng rỗng)
    let cartTable = document.getElementById("cartItems"); // Lấy phần tử bảng hiển thị giỏ hàng
    let totalPrice = 0; // Biến tổng giá trị đơn hàng

    if (!cartTable) {
        console.error("Lỗi: Không tìm thấy phần tử cartItems trong HTML.");
        return;
    }

    cartTable.innerHTML = cart.length ? "" : "<tr><td colspan='5'>Giỏ hàng trống</td></tr>"; // Nếu giỏ hàng rỗng thì hiển thị thông báo

    cart.forEach((item, index) => {
        let price = Number(item.priceCurrent.replace(/\D/g, "")) || 0; // Chuyển giá từ dạng chuỗi sang số (loại bỏ ký tự không phải số)
        let totalItemPrice = item.quantity * price; // Tính tổng giá của từng sản phẩm

        let row = `
            <tr>
                <td>${item.name}</td> <!-- Tên sản phẩm -->
                <td>${price.toLocaleString()} VND</td> <!-- Giá sản phẩm -->
                <td>${item.quantity}</td> <!-- Số lượng sản phẩm -->
                <td>${totalItemPrice.toLocaleString()} VND</td> <!-- Tổng giá tiền của sản phẩm đó -->
                <td><button onclick="removeItem(${index})">Xóa</button></td> <!-- Nút xóa sản phẩm -->
            </tr>`;
        cartTable.innerHTML += row; // Thêm sản phẩm vào bảng
        totalPrice += totalItemPrice; // Cộng giá vào tổng đơn hàng
    });

    let totalElement = document.getElementById("totalPrice"); // Lấy phần tử hiển thị tổng tiền
    if (totalElement) {
        totalElement.innerText = `${totalPrice.toLocaleString()} VND`; // Cập nhật tổng tiền
    } else {
        console.error("Lỗi: Không tìm thấy phần tử totalPrice trong HTML.");
    }
}

//   Xóa sản phẩm khỏi giỏ hàng
function removeItem(index) {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    if (index >= 0 && index < cart.length) {
        cart.splice(index, 1);
        localStorage.setItem("cart", JSON.stringify(cart));
        loadCart();
    }
}

// Xử lý khi trang được tải 
document.addEventListener("DOMContentLoaded", function () {
    let paymentForm = document.getElementById("paymentForm"); // Lấy form thanh toán
    let homeButton = document.getElementById("homeButton"); // Lấy nút "Trang chủ"

    if (paymentForm) {
        paymentForm.addEventListener("submit", function (event) {
            event.preventDefault(); // Ngăn chặn việc reload trang khi submit form

            let name = document.getElementById("fullname").value.trim(); // Lấy giá trị họ tên
            let address = document.getElementById("address").value.trim(); // Lấy giá trị địa chỉ
            let phone = document.getElementById("phone").value.trim(); // Lấy giá trị số điện thoại

            if (!name || !address || !phone) { // Kiểm tra xem có nhập đủ thông tin không
                alert("Vui lòng nhập đầy đủ thông tin thanh toán!");
                return;
            }

            alert("Đơn hàng của bạn đã được đặt thành công!"); // Hiển thị thông báo đặt hàng thành công
            localStorage.removeItem("cart"); // Xóa giỏ hàng khỏi localStorage
            loadCart(); // Cập nhật lại giao diện giỏ hàng (giỏ hàng trống)
        });
    } else {
        console.warn("Lưu ý: Không tìm thấy form thanh toán.");
    }

    if (homeButton) {
        homeButton.addEventListener("click", function () {
            window.location.href = "index.php"; // Chuyển hướng về trang chủ
        });
    } else {
        console.warn("Lưu ý: Không tìm thấy nút homeButton.");
    }

    loadCart(); // Gọi hàm loadCart để hiển thị giỏ hàng ngay khi trang được tải
});

